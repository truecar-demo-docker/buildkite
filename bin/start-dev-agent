#!/bin/bash

set -euo pipefail

export $(aws --profile build sts assume-role --role-arn arn:aws:iam::221344006312:role/buildkite-task --role-session-name buildkite-local-dev | jq -r '.Credentials | "AWS_ACCESS_KEY_ID=\(.AccessKeyId) AWS_SECRET_ACCESS_KEY=\(.SecretAccessKey) AWS_SESSION_TOKEN=\(.SessionToken)"')

export COMPOSE_FILE=docker-compose.yml:docker-compose.dev.yml

docker-compose up "$@"
